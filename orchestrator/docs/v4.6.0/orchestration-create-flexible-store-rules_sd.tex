\documentclass[a4paper]{arrowhead}

\usepackage[yyyymmdd]{datetime}
\usepackage{etoolbox}
\usepackage[utf8]{inputenc}
\usepackage{multirow}

\renewcommand{\dateseparator}{-}

\setlength{\parskip}{1em}

%% Special references
\newcommand{\fref}[1]{{\textcolor{ArrowheadBlue}{\hyperref[sec:functions:#1]{#1}}}}
\newcommand{\mref}[1]{{\textcolor{ArrowheadPurple}{\hyperref[sec:model:#1]{#1}}}}
\newcommand{\pdef}[1]{{\textcolor{ArrowheadGrey}{#1\label{sec:model:primitives:#1}\label{sec:model:primitives:#1s}\label{sec:model:primitives:#1es}}}}
\newcommand{\pref}[1]{{\textcolor{ArrowheadGrey}{\hyperref[sec:model:primitives:#1]{#1}}}}

\newrobustcmd\fsubsection[3]{
  \addtocounter{subsection}{1}
  \addcontentsline{toc}{subsection}{\protect\numberline{\thesubsection}interface \textcolor{ArrowheadBlue}{#1}}
  \renewcommand*{\do}[1]{\rref{##1},\ }
  \subsection*{
    \thesubsection\quad
    interface
    \textcolor{ArrowheadBlue}{#1}
    (\notblank{#2}{\mref{#2}}{})
    \notblank{#3}{: \mref{#3}}{}
  }
  \label{sec:functions:#1}
}
\newrobustcmd\msubsection[2]{
  \addtocounter{subsection}{1}
  \addcontentsline{toc}{subsection}{\protect\numberline{\thesubsection}#1 \textcolor{ArrowheadPurple}{#2}}
  \subsection*{\thesubsection\quad#1 \textcolor{ArrowheadPurple}{#2}}
  \label{sec:model:#2} \label{sec:model:#2s} \label{sec:model:#2es}
}
\newrobustcmd\msubsubsection[3]{
  \addtocounter{subsubsection}{1}
  \addcontentsline{toc}{subsubsection}{\protect\numberline{\thesubsubsection}#1 \textcolor{ArrowheadPurple}{#2}}
  \subsubsection*{\thesubsubsection\quad#1 \textcolor{ArrowheadPurple}{#2}}
  \label{sec:model:#2} \label{sec:model:#2s}
}
%%

\begin{document}

%% Arrowhead Document Properties
\ArrowheadTitle{orchestration-create-flexible-store-rules} % XXX = ServiceName 
\ArrowheadServiceID{orchestration-create-flexible-store-rules} % ID name of service
\ArrowheadType{Service Description}
\ArrowheadTypeShort{SD}
\ArrowheadVersion{4.6.0} % Arrowhead version X.Y.Z, e..g. 4.4.1
\ArrowheadDate{\today}
\ArrowheadAuthor{Rajmund Bocsi} % Corresponding author e.g. Jerker Delsing
\ArrowheadStatus{RELEASE} % e..g. RELEASE, RELEASE CONDIDATE, PROTOTYPE
\ArrowheadContact{rbocsi@aitia.ai} % Email of corresponding author
\ArrowheadFooter{\href{www.arrowhead.eu}{www.arrowhead.eu}}
\ArrowheadSetup
%%

%% Front Page
\begin{center}
  \vspace*{1cm}
  \huge{\arrowtitle}

  \vspace*{0.2cm}
  \LARGE{\arrowtype}
  \vspace*{1cm}

  %\Large{Service ID: \textit{"\arrowid"}}
  \vspace*{\fill}

  % Front Page Image
  %\includegraphics{figures/TODO}

  \vspace*{1cm}
  \vspace*{\fill}

  % Front Page Abstract
  \begin{abstract}
    This document provides service description for the \textbf{orchestration-create-flexible-store-rules} service. 
  \end{abstract}

  \vspace*{1cm}

%   \scriptsize
%   \begin{tabularx}{\textwidth}{l X}
%     \raisebox{-0.5\height}{\includegraphics[width=2cm]{figures/artemis_logo}} & {ARTEMIS Innovation Pilot Project: Arrowhead\newline
%     THEME [SP1-JTI-ARTEMIS-2012-AIPP4 SP1-JTI-ARTEMIS-2012-AIPP6]\newline
%     [Production and Energy System Automation Intelligent-Built environment and urban infrastructure for sustainable and friendly cities]}
%   \end{tabularx}
%   \vspace*{-0.2cm}
 \end{center}

\newpage
%%

%% Table of Contents
\tableofcontents
\newpage
%%

\section{Overview}
\label{sec:overview}
This document describes the \textbf{orchestration-create-flexible-store-rules} service which enables systems to add flexible matching rules to the Orchestrator Core System (if the Orchestrator is in flexible store mode).

The rest of this document is organized as follows.
In Section \ref{sec:functions}, we describe the abstract message functions provided by the service.
In Section \ref{sec:model}, we end the document by presenting the data types used by the mentioned functions.

\subsection{How This Service Is Meant to Be Used}
The Plant Description Engine Core System should consume the Service Registry Core Systemâ€™s \textbf{query} service to get information about the \textbf{orchestration-create-flexible-store-rules} service. Using this information the system can add a list of flexible store rules to the database of the Orchestrator Core System.

\subsection{Important Delimitations}
\label{sec:delimitations}

\begin{itemize}
    \item Only works if the Orchestrator Core System is in flexible store mode. Otherwise, it returns with an error.
    \item Not support rules about providers from an other cloud.
\end{itemize}

\subsection{Access policy}
\label{sec:accesspolicy}

This service is only available for the Plant Description Engine Core System.

\newpage

\section{Service Interface}
\label{sec:functions}

This section describes the interfaces to the service. The \textbf{orchestration-create-flexible-store-rules} service is used to add new rules to the Orchestrator's flexible store. The various parameters are representing the necessary system and service input information.
In particular, each subsection names an interface, an input type and an output type, in that order.
The input type is named inside parentheses, while the output type is preceded by a colon.
Input and output types are only denoted when accepted or returned, respectively, by the interface in question. All abstract data types named in this section are defined in Section 3.

The following interfaces are available.

\fsubsection{HTTP/TLS/JSON}{List$<$FlexibleRule$>$}{FlexibleRuleListResponse}

\begin{table}[ht!]
  \centering
  \begin{tabular}{|l|l|l|l|}
    \rowcolor{gray!33} Profile type & Type & Version \\ \hline
    Transfer protocol & HTTP & 1.1 \\ \hline
    Data encryption & TLS & 1.3 \\ \hline
    Encoding & JSON & RFC 8259 \cite{rfc8259} \\ \hline
    Compression & N/A & - \\ \hline
  \end{tabular}
  \caption{HTTP/TLS/JSON communication details.}
  \label{tab:comunication_semantics_profile}
\end{table}

\clearpage

\section{Information Model}
\label{sec:model}

Here, all data objects that can be part of the \textbf{orchestration-create-flexible-store-rules} service provides to the hosting System are listed in alphabetic order.
Note that each subsection, which describes one type of object, begins with the \textit{struct} keyword, which is used to denote a collection of named fields, each with its own data type.
As a complement to the explicitly defined types in this section, there is also a list of implicit primitive types in Section \ref{sec:model:primitives}, which are used to represent things like hashes and identifiers.

\msubsection{struct}{FlexibleRule}
\label{sec:model:FlexibleRule}
 
\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3.5cm} | p{3cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
consumerSystem & \hyperref[sec:model:SystemDescriptor]{SystemDescriptor} & yes & Requirements for a system that tells if this rule is applied to a consumer. \\ \hline
priority & \pref{Number} & no & Priority of the rule. \\ \hline
providerSystem & \hyperref[sec:model:SystemDescriptor]{SystemDescriptor} & yes & Requirements for a system that tells if this rule is applied to a provider. \\ \hline
serviceDefinition & \pref{Name} & yes & Identifier of a service. \\ \hline
serviceInterfaceName & \pref{Interface} & no & Interface requirement \\ \hline
serviceMetadata & \hyperref[sec:model:Metadata]{Metadata} & no & Service instance level metadata requirements. \\ \hline

\end{tabularx}
\end{table}

\msubsection{struct}{SystemDescriptor}
\label{sec:model:SystemDescriptor}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3cm} | p{3cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} Field & Type & Mandatory & Description \\ \hline
systemName & \pref{Name} & no (yes) & Name of a system. Mandatory if \textit{metadata} is not specified. \\ \hline
metadata & \hyperref[sec:model:Metadata]{Metadata} & no (yes) & System level metadata requirements (a system's metadata must contain all of its keys with the same value to match). Mandatory if \textit{systemName} is not specified. \\ \hline
\end{tabularx}
\end{table}


\msubsection{struct}{Metadata}
\label{sec:model:Metadata}

An \pref{Object} which maps \pref{String} key-value pairs.

\msubsection{struct}{FlexibleRuleListResponse}
\label{sec:model:FlexibleRuleListResponse}
 
\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{2cm} | p{5.0cm} | X |} \hline
\rowcolor{gray!33} Field & Type      & Description \\ \hline
count & \pref{Number} & The number of created rules. \\ \hline
data & \pref{List}$<$\hyperref[sec:model:FlexibleRuleResponse]{FlexibleRuleResponse}$>$ & Created rule records. \\ \hline
\end{tabularx}
\end{table}

\msubsection{struct}{FlexibleRuleResponse}
\label{sec:model:FlexibleRuleResponse}

\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{4.25cm} | p{3.5cm} | X |} \hline
\rowcolor{gray!33} Field & Type      & Description \\ \hline
consumerSystem & \hyperref[sec:model:SystemDescriptor]{SystemDescriptor} & Requirements for a system that tells if this rule is applied to a consumer. \\ \hline
createdAt & \pref{DateTime} & Rule record was created at this UTC time\-stamp. \\ \hline
id & \pref{Number} & Identifier of the rule. \\ \hline
priority & \pref{Number} & Priority of the rule. \\ \hline
providerSystem & \hyperref[sec:model:SystemDescriptor]{SystemDescriptor} & Requirements for a system that tells if this rule is applied to a provider. \\ \hline
serviceDefinition & \pref{Name} &  Identifier of a service. \\ \hline
serviceInterface & \pref{Interface} & Interface requirement \\ \hline
serviceMetadata & \hyperref[sec:model:Metadata]{Metadata} & Service instance level metadata requirements. \\ \hline
updatedAt & \pref{DateTime} & Rule record was modified at this UTC time\-stamp. \\ \hline
\end{tabularx}
\end{table}

\subsection{Primitives}
\label{sec:model:primitives}

Types and structures mentioned throughout this document that are assumed to be available to implementations of this service.
The concrete interpretations of each of these types and structures must be provided by any IDD document claiming to implement this service.


\begin{table}[ht!]
\begin{tabularx}{\textwidth}{| p{3cm} | X |} \hline
\rowcolor{gray!33} Type & Description \\ \hline
\pdef{DateTime}         & Pinpoints a specific moment in time. \\ \hline
\pdef{Object}           & Set of primitives and possible further objects. \\ \hline
\pdef{Interface}        & Any suitable type chosen by the implementor of service \\ \hline
\pdef{List}$<$A$>$      & An \textit{array} of a known number of items, each having type A. \\ \hline
\pdef{Name}             & A string identifier that is intended to be both human and machine-readable. \\ \hline
\pdef{Number}           & Decimal number \\ \hline
\end{tabularx}
\end{table}

\newpage

\bibliographystyle{IEEEtran}
\bibliography{bibliography}

\newpage

\section{Revision History}
\subsection{Amendments}

\noindent\begin{tabularx}{\textwidth}{| p{1cm} | p{3cm} | p{2cm} | X | p{4cm} |} \hline
\rowcolor{gray!33} No. & Date & Version & Subject of Amendments & Author \\ \hline

1 & YYYY-MM-DD & \arrowversion & & Xxx Yyy \\ \hline
\end{tabularx}

\subsection{Quality Assurance}

\noindent\begin{tabularx}{\textwidth}{| p{1cm} | p{3cm} | p{2cm} | X |} \hline
\rowcolor{gray!33} No. & Date & Version & Approved by \\ \hline

1 & YYYY-MM-DD & \arrowversion  &  \\ \hline

\end{tabularx}

\end{document}